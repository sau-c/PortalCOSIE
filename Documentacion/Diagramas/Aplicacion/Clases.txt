@startuml
' --- CONFIGURACIÓN DE DISEÑO ---
skinparam classAttributeIconSize 0
skinparam linetype ortho
skinparam nodesep 50
skinparam ranksep 60
skinparam shadowing true

' ==========================================
' ESTILOS DE COLORES (VIBRANTE)
' ==========================================

' 1. Estilo para Entidades Raíz (Aggregate Roots) -> AZUL
skinparam class {
    BackgroundColor<<Root>> #E8F8F5
    BorderColor<<Root>> #117864
    BorderThickness<<Root>> 2
}

' 4. Estilo para Paquetes (Agregados) -> GRIS LIMPIO
skinparam package {
    Style Rectangle
    BackgroundColor<<Aggregate>> White
    BorderColor<<Aggregate>> #616161
    BorderStyle<<Aggregate>> Dashed
    FontColor<<Aggregate>> #616161
    FontSize 13
    FontStyle Bold
}

' ==========================================
' DEFINICIÓN DE PAQUETES Y CLASES
' ==========================================

' --- SHARED KERNEL ---
package "Shared Kernel" {
    abstract class BaseEntity {
        + Id : int
        + IsDeleted : bool
        + SoftDelete()
        + Restore()
    }

    class Enumeration <<Enumeration>> {
        + Id : int
        + Nombre : string
    }
    
    BaseEntity -[hidden]right- Enumeration
}

' --- AGREGADO: IDENTIDAD ---
package "Usuario Aggregate" <<Aggregate>> {
    abstract class Usuario <<Root>> {
        + IdentityUserId : string
        + Nombre : string
        + ApellidoPaterno : string
        + ApellidoMaterno : string
    }

    class Alumno {
        + NumeroBoleta : string
        + PeriodoIngreso : string
        + CarreraId : int
    }

    class Personal {
        + IdEmpleado : string
        + Area : string
    }
    
    Usuario <|-- Alumno
    Usuario <|-- Personal
}

' --- AGREGADO: ACADÉMICO ---
package "Carrera Aggregate" <<Aggregate>> {
    class Carrera <<Root>> {
        + Nombre : string
        + AgregarUnidad()
    }

    class UnidadAprendizaje {
        + Nombre : string
        + Semestre : Semestre
        + CarreraId : int
    }

    enum Semestre {
        PRIMERO
        SEGUNDO
        ...
    }
    
    Carrera "1" *-- "*" UnidadAprendizaje
    UnidadAprendizaje .> Semestre
}

' --- AGREGADO: TRÁMITES (CORE DOMAIN) ---
package "Tramite Aggregate" <<Aggregate>> {
    abstract class Tramite <<Root>> {
        + FechaSolicitud : DateTime
        + PeriodoSolicitud : string
        + EstadoTramiteId : int
        + TipoTramiteId : int
        + AlumnoId : int
        + AsignarPersonal()
        + CambiarEstado()
        + Concluir()
    }

    class TramiteCTCE {
        + Peticion : string
        + TieneDictamenesAnteriores : bool
        + SetDocumentoObligatorio()
    }

    class UnidadReprobada {
        + PeriodoCurso : string
        + PeriodoRecurse : string
        + UnidadAprendizajeId : string
    }

    class Documento {
        + Nombre : string
        + Observaciones : string
        + Contenido : byte[]
        + SetEstado()
    }

    class EstadoTramite <<Enumeration>> {
        + Solicitado
        + EnRevision
        + Concluido
    }

    class TipoTramite <<Enumeration>> {
        + DictamenInterno
        + DictamenExterno
    }

    class EstadoDocumento <<Enumeration>> {
        + EnRevision
        + Validado
        + ConErrores
    }

    class TipoDocumento <<Enumeration>> {
        + Identificacion
        + BoletaGlobal
        + Probatorios
    }

    ' Relaciones Internas Trámite
    Tramite <|-- TramiteCTCE
    Tramite "1" *-- "*" Documento
    TramiteCTCE "1" *-- "*" UnidadReprobada
    
    Tramite .> EstadoTramite
    Tramite .> TipoTramite
    Documento .> EstadoDocumento
    Documento .> TipoDocumento
    
    ' Layout Interno Vertical
    Tramite -[hidden]down- TramiteCTCE
    TramiteCTCE -[hidden]down- Documento
    Documento -[hidden]down- UnidadReprobada
}

' --- AGREGADO: BITÁCORA ---
package "Bitacora Aggregate" <<Aggregate>> {
    class EntradaBitacora <<Root>> {
        + Accion : string
        + Entidad : string
        + EntidadId : string
        + IdentityUserId : string
        + FechaRegistro : DateTime
    }
}

' --- AGREGADO: PLANEACIÓN (Al final) ---
package "Planeación Aggregate" <<Aggregate>> {
    class SesionCOSIE <<Root>> {
        + NumeroSesion : string
        + FechaSesion : DateTime?
        + SetFechasRecepcion()
    }

    class FechaRecepcion {
        + Fecha : DateTime
        + SesionId : int
    }

    class PeriodoConfig <<Root>> {
        + AnioInicio : int
        + AnioActual : int
    }
    
    SesionCOSIE "1" *-- "*" FechaRecepcion
    SesionCOSIE -[hidden]down- PeriodoConfig
}

' ==========================================
' RELACIONES EXTERNAS Y HERENCIA BASE
' ==========================================

BaseEntity <|-- Usuario #line:silver
BaseEntity <|-- Carrera #line:silver
BaseEntity <|-- UnidadAprendizaje #line:silver
BaseEntity <|-- Tramite #line:silver
BaseEntity <|-- Documento #line:silver
BaseEntity <|-- UnidadReprobada #line:silver
BaseEntity <|-- SesionCOSIE #line:silver
BaseEntity <|-- FechaRecepcion #line:silver
BaseEntity <|-- EntradaBitacora #line:silver
BaseEntity <|-- Enumeration #line:silver
BaseEntity <|-- PeriodoConfig #line:silver

Enumeration <|-- EstadoTramite #line:silver
Enumeration <|-- TipoTramite #line:silver
Enumeration <|-- EstadoDocumento #line:silver
Enumeration <|-- TipoDocumento #line:silver

' Relaciones de Negocio Cruzadas
Tramite --> Alumno : Solicitado por
Tramite --> Personal : Asignado a
Alumno --> Carrera : Inscrito en
UnidadReprobada --> UnidadAprendizaje : Refiere a

' ==========================================
' LAYOUT MASTER (COLUMNA VERTICAL ESTRICTA)
' ==========================================
' Esta sección fuerza el orden: Shared -> Usuario -> Carrera -> Tramite -> Bitacora -> Planeación

BaseEntity -[hidden]down- Usuario
Usuario -[hidden]down- Carrera
Carrera -[hidden]down- Tramite
Tramite -[hidden]down- EntradaBitacora
EntradaBitacora -[hidden]down- SesionCOSIE

@enduml