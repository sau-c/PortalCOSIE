@{
    ViewData["Title"] = "Catálogos del sistema";
}

<div class="card shadow">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div>
            <h6 class="mb-0 fw-bold py-2">@ViewData["Title"]</h6>
        </div>
    </div>

    <div class="card-body overflow-auto p-4" style="height: calc(100vh - 164px);">
        <!-- Tabs -->
        <ul class="nav nav-tabs" id="catalogosTabs" role="tablist">
            <li class="nav-item">
                <button class="nav-link active"
                        data-bs-toggle="tab"
                        data-bs-target="#tipo"
                        data-action="@Url.Action("Tipo", "Catalogos")"
                        type="button">
                    Tipo de trámite
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link"
                        data-bs-toggle="tab"
                        data-bs-target="#estadoTramite"
                        data-action="@Url.Action("Estados", "Catalogos")"
                        type="button">
                    Estado de trámite
                </button>
            </li>
            <li class="nav-item">
                <button class="nav-link"
                        data-bs-toggle="tab"
                        data-bs-target="#estadoDocumento"
                        data-action="@Url.Action("EstadosDocumento", "Catalogos")"
                        type="button">
                    Estado de documento
                </button>
            </li>
        </ul>

        <!-- Contenedores de contenido -->
        <div class="tab-content pt-3">
            <div class="tab-pane fade show active" id="tipo"></div>
            <div class="tab-pane fade" id="estadoTramite"></div>
            <div class="tab-pane fade" id="estadoDocumento"></div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {

            // Función para cargar el contenido de un catálogo vía AJAX
            function loadCatalog(tabButton) {
                const target = $(tabButton).data("bs-target");
                const action = $(tabButton).data("action");
                const $container = $(target);

                // Si ya fue cargado, no lo recargamos
                if ($container.data("loaded")) return;

                // Petición AJAX al servidor
                $.get(action, function (data) {
                    $container.html(data);
                    $container.data("loaded", true); // marcar como cargado
                }).fail(() => {
                    $container.html('<div class="text-danger p-3">Error al cargar el catálogo.</div>');
                });
            }

            // Cargar el primer tab al inicio
            loadCatalog($(".nav-link.active")[0]);

            // Cargar cuando el usuario cambia de tab
            $(".nav-link").on("shown.bs.tab", function (e) {
                loadCatalog(e.target);
            });
        });
    </script>
}
