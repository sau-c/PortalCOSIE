<!-- Modal Activar/Desactivar -->
<div class="modal fade" id="desactivarModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitulo"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form asp-action="ToggleSesionCOSIE" method="post">
                @Html.AntiForgeryToken()
                <input type="hidden" id="desactivarId" name="id" />
                <input type="hidden" id="accionEstado" name="accion" />

                <div class="modal-body text-center">
                    <i id="modalIcono" class="fas fa-3x mb-3"></i>
                    <h6 id="modalMensaje" class="fw-bold mb-2"></h6>
                    <p class="text-muted mb-0">
                        Sesión: <span id="desactivarNumeroSesion" class="fw-semibold"></span>
                    </p>
                    <p id="modalDetalle" class="text-muted mb-0"></p>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" id="btnConfirmarEstado" class="btn">
                        <i id="btnIcono" class="fas me-1"></i>
                        <span id="btnTexto"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {

        const estados = {
            activar: {
                headerClass: 'bg-success text-white',
                titulo: 'Activar sesión',
                mensaje: '¿Está seguro que desea activar esta sesión?',
                detalle: 'La sesión volverá a estar visible para los usuarios.',
                icono: 'fa-eye',
                boton: 'btn-success',
                btnIcono: 'fa-eye',
                btnTexto: 'Activar',
                accion: 'activar'
            },
            desactivar: {
                headerClass: 'bg-danger text-white',
                titulo: 'Desactivar sesión',
                mensaje: '¿Está seguro que desea desactivar esta sesión?',
                detalle: 'Se ocultará la sesión a los demás usuarios.',
                icono: 'fa-exclamation-triangle text-warning',
                boton: 'btn-danger',
                btnIcono: 'fa-eye-slash',
                btnTexto: 'Desactivar',
                accion: 'desactivar'
            }
        };

        $(document).on('click', '.btn-toggle-estado', function () {
            const id = $(this).data('id');
            const numero = $(this).data('numero-sesion');
            const isDeleted = $(this).data('isdeleted') === true || $(this).data('isdeleted') === "True";

            const modal = $('#desactivarModal');
            const header = modal.find('.modal-header');
            const btn = $('#btnConfirmarEstado');

            // Datos comunes
            $('#desactivarId').val(id);
            $('#desactivarNumeroSesion').text(numero);

            // Determinar estado
            const estadoKey = isDeleted ? 'activar' : 'desactivar';
            const e = estados[estadoKey];

            // Limpiar clases previas
            header.removeClass('bg-danger bg-success text-white');
            btn.removeClass('btn-danger btn-success');
            $('#modalIcono').removeClass('fa-eye fa-exclamation-triangle text-warning text-white');
            $('#btnIcono').removeClass('fa-eye fa-eye-slash');

            // Aplicar configuración
            header.addClass(e.headerClass);
            modal.find('#modalTitulo').text(e.titulo);
            modal.find('#modalMensaje').text(e.mensaje);
            modal.find('#modalDetalle').text(e.detalle);
            $('#modalIcono').addClass(e.icono);
            btn.addClass(e.boton);
            $('#btnIcono').addClass(e.btnIcono);
            $('#btnTexto').text(e.btnTexto);
            $('#accionEstado').val(e.accion);
        });
    });
</script>
