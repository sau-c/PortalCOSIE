<div class="modal fade" id="modalConfirmarRevision" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h6 class="modal-title">
                    <i class="fas fa-check-circle me-2"></i>Confirmar revisión
                </h6>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>

            <div class="modal-body p-4 text-center">
                <div class="mb-3 text-primary bg-primary bg-opacity-10 d-inline-block p-3 rounded-circle">
                    <i class="fas fa-tasks fa-2x"></i>
                </div>
                <h5 class="fw-bold mb-2">¿Confirmas la revisión de los documentos?</h5>
                <p class="text-muted small mb-0">
                    Verifica que los estados y observaciones de los documentos sean correctos.
                </p>
                <p class="text-muted small mt-2">Esta acción guardará la revisión y no se puede deshacer.</p>
            </div>

            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" id="btnConfirmarRevision" class="btn btn-primary">
                    <i class="fas fa-check me-2"></i>Sí, guardar revisión
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const formRevision = document.getElementById("formRevision");
        const modalElement = document.getElementById('modalConfirmarRevision');
        const btnConfirmar = document.getElementById('btnConfirmarRevision');

        if (!formRevision) return;

        const bsModal = new bootstrap.Modal(modalElement);
        const control = bloqueadorBoton(btnConfirmar);

        // Interceptar submit del formulario
        formRevision.addEventListener("submit", function (e) {
            e.preventDefault();
            e.stopPropagation();

            // Abrir modal de confirmación
            bsModal.show();
        });

        // Botón "Sí, guardar revisión"
        btnConfirmar.addEventListener("click", async function () {
            control.bloquear();

            try {
                const url = formRevision.getAttribute("action");
                const formData = new FormData(formRevision);
                const data = await executeFetch(url, "POST", formData);

                showGlobalModal("success", data.message, {
                    redirectUrl: '/Tramite',
                });

            } catch (error) {
                showGlobalModal("error", error.message, {
                    onClose: () => control.restaurar()
                });
            }
        });
    });
</script>
